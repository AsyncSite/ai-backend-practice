# [Session 03] AI 활용 프롬프트 -- 외부 연동

## 1단계: 이해

```
서킷 브레이커의 3가지 상태(CLOSED, OPEN, HALF-OPEN)의 전이 조건을 설명해줘.
각 상태에서 요청이 어떻게 처리되는지 시퀀스 다이어그램으로 보여줘.
```

```
멱등성(Idempotency)이 뭔지 설명하고,
결제 API에서 멱등키를 사용하는 구체적인 흐름을 코드와 함께 알려줘.
```

## 2단계: 적용

```
Spring Retry + Resilience4j로 지수 백오프 재시도 코드를 만들어줘.
요구사항:
- 최대 3번 재시도
- 초기 간격 1초, 배수 2 (1초 -> 2초 -> 4초)
- jitter 추가 (재시도 폭주 방지)
- 특정 예외만 재시도 (TimeoutException, 5xx 에러)
```

## 3단계: 검증

```
이 재시도 로직이 멱등하지 않은 API에서 안전한가?
결제 API를 재시도할 때 이중 결제가 발생할 수 있는 시나리오를 설명하고,
방지 방법을 알려줘.
```

```
[AI가 틀릴 수 있는 포인트]
AI가 생성한 Resilience4j 설정은 특정 라이브러리 버전에 종속적일 수 있습니다.
반드시 실행하여 에러가 없는지 확인하세요.
```
